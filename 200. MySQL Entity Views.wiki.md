## MySQL Entity Views · Documentation

### Overview

**MySQL Entity Views** flattens Drupal content entities (nodes, media, etc.) into **per-bundle VIEWs** that are easy to consume from BI tools. It also generates **meta-views** describing each column from Drupal’s Field UI.

* **Why**: Avoid complex JOINs over many `field_*` tables
* **What**: `view_<entity_type>__<bundle>` (+ `__meta`)
* **Scope**: Read-only MySQL/MariaDB; ignores non-MySQL drivers

---

### Installation

**Composer:**

```bash
composer require bluemarloc/bm_mysql_entity_views
drush en bm_mysql_entity_views -y
```

The module builds initial views on install.

**Manual:**
Copy the module into `modules/custom/` and enable with Drush or UI.

---

### Configuration

**Path**: `/admin/config/development/mysql-entity-views`

* **GROUP_CONCAT separator**
* **group_concat_max_len** (session)
* **Ordering for multi-value**: `delta` | `value` | `none`
* **Create meta views**: toggles companion `__meta` view

You can **Add/Update** per bundle or **Rebuild all**.

---

### View Anatomy

**Data view**: `view_node__article`
Columns include:

* Base: `id, langcode, type, [title], uid, status, created, changed`
* Field columns: one per field; multi-value aggregated using `GROUP_CONCAT`

**Meta view**: `view_node__article__meta`

| column_name | comment                                | source    |
| ----------- | -------------------------------------- | --------- |
| id          | Entity ID                              | base      |
| title       | Title                                  | base      |
| field_tags  | Tags: (Field description, if provided) | field:... |
| …           | …                                      | …         |

> MySQL doesn’t persist column comments for VIEWs; the meta view makes them queryable.

---

### Query Examples

Get latest published articles:

```sql
SELECT id, title, status, created, field_tags
FROM view_node__article
WHERE status = 1
ORDER BY created DESC
LIMIT 50;
```

Join with comments:

```sql
SELECT a.title, m.comment
FROM view_node__article a
JOIN view_node__article__meta m
  ON m.column_name = 'field_tags';
```

---

### Performance & Limits

* VIEWs are evaluated by the DB; use **LIMIT**, date filters, or replicate to a read-replica for BI.
* Very wide concatenations: increase **group_concat_max_len**.
* Changes to fields require a **Rebuild**.

---

### FAQ

**Q: Can I filter by a multi-value field’s individual values?**
A: Yes, but remember it’s a concatenated string. For robust analytics, consider exporting normalized rows to a warehouse.

**Q: Access control?**
A: VIEWs bypass Drupal’s access checks. Expose only to trusted readers or use app-level ACLs.

**Q: Does it support non-content entities?**
A: Any content entity with a base table and bundles works. Pure config entities are out of scope.

---

### Extending

Planned/possible enhancements:

* Include **field type**, **requiredness**, **cardinality**, **target entity** in meta views
* Per-field **custom separators**
* **Exclude/include** field lists in UI
* First-class **Drush commands** (wrappers for generator methods)

Open an issue or PR with your use case.

---

### Troubleshooting

* No views? Ensure DB driver is MySQL/MariaDB and bundle actually exists with a base table.
* Truncated concatenations? Increase **group_concat_max_len**.
* After field changes (add/remove/rename), **Rebuild** in the settings UI.

---

### License

GPL-2.0-or-later.

---

Want me to add a `CHANGELOG.md`, GitHub Actions CI (PHPStan, PHPUnit matrix), or pack it for Packagist auto-updates?
